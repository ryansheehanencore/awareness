<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Transcription Display</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        #transcription {
            text-align: center;
            font-size: 24px;
            opacity: 0;
            transition: opacity 1s;
            word-wrap: break-word;
            max-width: 90vw;
            line-height: 1.4;
        }

        #menu {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 16px;
            opacity: 0;
            transition: opacity 1s;
        }

        .visible {
            opacity: 1 !important;
        }

        .fade-out {
            opacity: 0;
            transition: opacity 0.5s;
        }
    </style>
</head>
<body>
    <div id="menu">Up/Down Font Size: 24 | Left/Right Fade Rate: 1000ms</div>
    <div id="transcription"></div>

    <script>
        let isMuted = true;
        let transcript = document.getElementById('transcription');
        let menu = document.getElementById('menu');
        let fontSize = 24;
        let fadeRate = 1000;
        let currentLines = [];  // Array to store currently displayed lines

        const updateMenu = () => {
            menu.innerHTML = `Up/Down Font Size: ${fontSize} | Left/Right Fade Rate: ${fadeRate}ms`;
            menu.classList.add('visible');
            setTimeout(() => menu.classList.remove('visible'), 1000);
        };

        const fadeOutOldestLine = () => {
            // Fades out the oldest line quickly
            transcript.classList.add('fade-out');
            setTimeout(() => {
                transcript.classList.remove('fade-out');
            }, 500);  // 500ms quick fade out
        };

        const updateDisplay = () => {
            // Update the display with the current lines
            transcript.innerHTML = currentLines.join('<br>');
            transcript.style.fontSize = `${fontSize}px`;
            transcript.style.opacity = 1;
        };

        const addWordToLine = (text) => {
            if (currentLines.length === 0) {
                currentLines.push(text);  // Add first line
            } else {
                // Add to the current (last) line
                let lastLine = currentLines[currentLines.length - 1];
                if (lastLine.length + text.length < 60) { // Adjust 60 to fit your needs
                    currentLines[currentLines.length - 1] = lastLine + ' ' + text;
                } else {
                    currentLines.push(text);  // Start a new line
                }
            }

            // If there are more than 2 lines, remove the first one
            if (currentLines.length > 2) {
                currentLines.shift();  // Remove the oldest line
                fadeOutOldestLine();    // Fade it out
            }

            updateDisplay();
        };

        const handleTranscription = (event) => {
            if (!isMuted) {
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const result = event.results[i];
                    if (result[0].transcript.trim() !== '') {
                        addWordToLine(result[0].transcript.trim());  // Add words one by one
                    }
                    if (result.isFinal) {
                        // Clear the lines after a pause
                        setTimeout(() => {
                            currentLines = [];
                            transcript.style.opacity = 0;
                        }, fadeRate);
                    }
                }
            }
        };

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = true;
        recognition.interimResults = true;  // Enable interim results
        recognition.onresult = handleTranscription;

        let fadeOutTimeout;

        window.addEventListener('keydown', (event) => {
            switch (event.key) {
                case 'M':
                case 'm':
                    isMuted = !isMuted;
                    if (!isMuted) {
                        recognition.start();
                        transcript.innerHTML = 'Listening...';
                    } else {
                        recognition.stop();
                        transcript.innerHTML = "Press 'M' to unmute";
                        currentLines = [];  // Clear lines when muted
                    }
                    break;
                case 'ArrowUp':
                    fontSize += 2;
                    updateMenu();
                    break;
                case 'ArrowDown':
                    fontSize -= 2;
                    updateMenu();
                    break;
                case 'ArrowLeft':
                    fadeRate = Math.max(500, fadeRate - 100);
                    updateMenu();
                    break;
                case 'ArrowRight':
                    fadeRate += 100;
                    updateMenu();
                    break;
            }
        });

        updateMenu();  // Initialize menu
    </script>
</body>
</html>
