<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Captions Tool</title>
    <style>
        body {
            margin: 0;
            background: black;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #menu {
            position: fixed;
            top: 10px;
            left: 10px;
            font-size: 14px;
            opacity: 1;
            transition: opacity 0.5s;
        }
        #transcription-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            justify-content: center;
        }
        .transcription-line {
            margin: 10px 0;
            text-align: center;
            transition: opacity 0.5s;
        }
        #start-prompt {
            font-size: 24px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="menu">
        Font Size: <span id="font-size">50</span><br>
        Fade Time: <span id="fade-time">500</span>ms<br>
        ↑/↓: Adjust font size<br>
        ←/→: Adjust fade time
    </div>
    
    <div id="transcription-container">
        <div id="start-prompt">Press 'M' to start transcription</div>
    </div>

    <script>
        let fontSize = 50;
        let fadeTime = 500;
        let transcriptionActive = false;
        let recognition = null;
        let currentPhrase = '';
        let phrasePauseTimeout = null;
        const PHRASE_PAUSE = 300; // ms before considering a phrase complete
        
        const lines = [];
        const menu = document.getElementById('menu');
        const startPrompt = document.getElementById('start-prompt');
        const transcriptionContainer = document.getElementById('transcription-container');
        const fontSizeDisplay = document.getElementById('font-size');
        const fadeTimeDisplay = document.getElementById('fade-time');

        function updateSettings() {
            fontSizeDisplay.textContent = fontSize;
            fadeTimeDisplay.textContent = fadeTime;
            document.querySelectorAll('.transcription-line').forEach(line => {
                line.style.fontSize = `${fontSize}px`;
            });
        }

        function addLine(text) {
            const line = document.createElement('div');
            line.className = 'transcription-line';
            line.style.fontSize = `${fontSize}px`;
            line.textContent = text;
            
            lines.push(line);
            transcriptionContainer.appendChild(line);
            
            if (lines.length > 3) {
                const oldestLine = lines.shift();
                oldestLine.style.opacity = '0';
                setTimeout(() => oldestLine.remove(), fadeTime);
            }
        }

        function startTranscription() {
            if (transcriptionActive) return;
            
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onresult = (event) => {
                const result = event.results[event.results.length - 1];
                const transcript = result[0].transcript;
                
                if (result.isFinal) {
                    if (currentPhrase) {
                        addLine(currentPhrase);
                        currentPhrase = '';
                    }
                    addLine(transcript);
                } else {
                    currentPhrase = transcript;
                    clearTimeout(phrasePauseTimeout);
                    phrasePauseTimeout = setTimeout(() => {
                        if (currentPhrase) {
                            addLine(currentPhrase);
                            currentPhrase = '';
                        }
                    }, PHRASE_PAUSE);
                }
            };

            recognition.onend = () => {
                if (transcriptionActive) {
                    recognition.start();
                }
            };

            transcriptionActive = true;
            startPrompt.style.display = 'none';
            recognition.start();
            
            setTimeout(() => {
                menu.style.opacity = '0';
            }, 3000);
        }

        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'm':
                case 'M':
                    startTranscription();
                    break;
                case 'ArrowUp':
                    fontSize = Math.min(fontSize + 2, 100);
                    updateSettings();
                    break;
                case 'ArrowDown':
                    fontSize = Math.max(fontSize - 2, 20);
                    updateSettings();
                    break;
                case 'ArrowLeft':
                    fadeTime = Math.max(fadeTime - 100, 100);
                    updateSettings();
                    break;
                case 'ArrowRight':
                    fadeTime = Math.min(fadeTime + 100, 2000);
                    updateSettings();
                    break;
            }
        });

        // Touch events for mobile support
        let touchStartY = 0;
        let touchStartX = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
            touchStartX = e.touches[0].clientX;
        });

        document.addEventListener('touchmove', (e) => {
            const touchY = e.touches[0].clientY;
            const touchX = e.touches[0].clientX;
            const deltaY = touchStartY - touchY;
            const deltaX = touchStartX - touchX;
            
            if (Math.abs(deltaY) > Math.abs(deltaX)) {
                // Vertical swipe
                if (deltaY > 0) {
                    fontSize = Math.min(fontSize + 2, 100);
                } else {
                    fontSize = Math.max(fontSize - 2, 20);
                }
            } else {
                // Horizontal swipe
                if (deltaX > 0) {
                    fadeTime = Math.max(fadeTime - 100, 100);
                } else {
                    fadeTime = Math.min(fadeTime + 100, 2000);
                }
            }
            updateSettings();
        });
    </script>
</body>
</html>
