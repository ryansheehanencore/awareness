<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Audio Transcription</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #transcript {
            text-align: center;
            font-size: 50px;
            transition: opacity 0.5s;
        }
    </style>
</head>
<body>
    <div id="transcript"></div>
    <script>
        const transcriptDiv = document.getElementById('transcript');
        let recognition;
        let fadeTimeout;
        let fadeDuration = 500; // Default fade-out duration

        // Initialize speech recognition
        function startRecognition() {
            if (!('webkitSpeechRecognition' in window)) {
                alert('Your browser does not support speech recognition. Please use Chrome or Safari.');
                return;
            }
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onstart = () => {
                console.log('Speech recognition started.');
            };

            recognition.onresult = (event) => {
                const results = event.results;
                const transcript = Array.from(results)
                    .map(result => result[0].transcript)
                    .join(' ');

                const currentPhrase = transcript.trim();

                // Only display if there's a new valid phrase
                if (currentPhrase !== '' && transcriptDiv.textContent !== currentPhrase) {
                    clearTimeout(fadeTimeout); // Clear the previous fade-out timeout
                    displayText(currentPhrase); // Display the new phrase
                    fadeTimeout = setTimeout(() => fadeOutText(), 500); // Start fade-out after 500ms of silence
                }
            };

            recognition.onend = () => {
                console.log('Speech recognition ended. Restarting...');
                recognition.start(); // Restart recognition
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error: ', event.error);
            };

            recognition.start();
        }

        function displayText(text) {
            transcriptDiv.textContent = text; // Display the current phrase
            transcriptDiv.style.opacity = 1; // Reset opacity for new text
        }

        function fadeOutText() {
            transcriptDiv.style.opacity = 0; // Start fade out
            setTimeout(() => {
                transcriptDiv.textContent = ''; // Clear text after fade out
            }, fadeDuration);
        }

        document.addEventListener('keydown', (event) => {
            switch(event.key) {
                case 'm':
                    startRecognition();
                    break;
                case 'ArrowUp':
                    adjustFontSize(5);
                    break;
                case 'ArrowDown':
                    adjustFontSize(-5);
                    break;
                case 'ArrowLeft':
                    adjustFadeOutDuration(-100);
                    break;
                case 'ArrowRight':
                    adjustFadeOutDuration(100);
                    break;
                default:
                    break;
            }
        });

        function adjustFontSize(change) {
            const currentSize = parseInt(window.getComputedStyle(transcriptDiv).fontSize);
            transcriptDiv.style.fontSize = `${currentSize + change}px`;
        }

        function adjustFadeOutDuration(change) {
            fadeDuration = Math.max(100, fadeDuration + change); // Ensure fadeDuration is at least 100ms
            clearTimeout(fadeTimeout);
            fadeTimeout = setTimeout(() => fadeOutText(), fadeDuration);
        }

        // Request microphone access on page load
        window.onload = function() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(() => {
                    console.log('Microphone access granted.');
                })
                .catch((error) => {
                    console.error('Microphone access denied: ', error);
                });
        };
    </script>
</body>
</html>
